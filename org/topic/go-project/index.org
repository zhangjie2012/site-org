#+SETUPFILE: ~/site/tpl/wiki-tpl.org
#+TITLE:  构建 Go 项目最佳实践
#+DATE: 2021-04-27 15:33:45

* 语言学习

- [[../../blog/2017/gopl-notes.org][Go 语言圣经学习笔记]] 2017 年学习 Go 的笔记，虽然有些内容有些老旧（比如 package 管理），但语言核心的东西是没大变化
- [[../../blog/2018/effective-go-notes.org][Effective Go 精简版]] 比较基础的用法，教你避“坑”
- [[../../blog/2018/go-defer-panic-reover.org][Go 的异常处理：defer，panic，recover]]
- [[../../blog/2018/understand-go-array-and-slice.org][理解 Go 的 Array 和 Slice]]：除了理解之外，主要的记录了使用 Slice 过程中遇到的“坑”，但是 gopher 似乎不认为是个“设计缺陷”
- [[../../blog/2018/go-http-get-close-body.org][Go http 请求必须要手动 resp.Body.Close]] 基本上每个 gopher 都翻过的错，不关闭 resp.body 导致 fd 飙升
- [[../../blog/2020/go-mysql-closing-bad-idle-connection.org][Go MySQL 报错 closing bad idle connection: EOF]] 一次问题排查
- [[../../blog/2021/go-range.org][Go for...range]] 实际上 range 返回的都是浅拷贝，并不是迭代器
  
* package 管理和发布

以前用 govender，go 1.11 之后统一使用 module 了。[[file:../../wiki/programming/go/package-manager.org][包管理工具]]。

- [[https://encore.dev/guide/go.mod][Go modules cheat sheet]]

* 工程实践

* 目录结构

Go 目前没有一个权威性质的 Web framework（类似 Python 的 Django/Flask，Java 的 SprintBoot 等），大部分 Web 框架所做的事情
是 router + middleware 的方式。并没有提供了一个如何组织项目代码，划分模块的规范。这可能与 Go 生态圈的文化和语言的应用场景有关。

尽管如此，还是需要一个规范性的东西来约束，方便协作。评价比较高的有 [[https://github.com/golang-standards/project-layout][project-layout]]，它参考了主流的 Go 开源代码的组织方式，
2019 年开始我也进行了断断续续的翻译 [[file:project-layout.org][Go 项目布局标准]]。现在官方也支持 [[https://github.com/golang-standards/project-layout/blob/master/README_zh.md][中文版]] 了。实际体验下来，大体思路是没错的，但对于构建一个 Web 服务
来说，还是太过宽泛了。所以我根据自己的经验，在 Go project layout 的基础上整理了一套属于自己的规范。

- [[file:project-layout.org][Go 项目目录结构]]

* package 发布

一个 github 的 Go 项目如何发布？[[file:../../wiki/programming/go/go-package-release.org][Go 项目发布]]。

* 技术选型

- [[file:go-web-framework.org][Web 框架选择]]
- [[file:redis.org][Redis]]
- [[file:log.org][Go logger packages]]
- [[file:go-mysql.org][Go MySQL]]，还是使用 ent 吧
- [[file:go-mongodb.org][Go MongoDB]]
- http client：[[https://github.com/go-resty/resty][resty]]
- 序列化：[[https://github.com/vmihailenco/msgpack][msgpack]] 说是比 JSON 的效率高五六倍，文档 https://msgpack.uptrace.dev/

* 编码规范

- 使用 [[https://golangci-lint.run/usage/configuration/][golangci-lint]] 作为 linter，[[https://gitlab.com/JerryZhang2012/dotfiles/-/blob/master/_golangci.yaml][我的配置]]，macOS 下添加软链到 =~/.golangci.yaml=
- [[https://github.com/uber-go/guide][uber go guide]]

* 服务质量

- [[file:write-go-testing.org][单元测试]]
- [[file:monitor.org][使用 Prometheus 监控 API]]
- [[file:go-profile.org][调优]]

* 上线

- [[file:build-deploy.org][构建和部署]]
